{% extends "global_layout.html" %}

{% block title %}Agent Performance Overview{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
{% endblock %}

{% block content %}
<div class="report-main container-fluid">
  <div class="row g-3">
    <aside class="filters-panel col-lg-2">
      <h3 class="mb-3">Filters</h3>
      <div class="filter-group mb-3 time-filter">
        <label class="form-label fw-bold">Time Period</label>
        <div class="radio-group d-flex flex-column">
          <label><input type="radio" name="time" value="today"> Today</label>
          <label><input type="radio" name="time" value="week"> This week</label>
          <label><input type="radio" name="time" value="month"> This month</label>
          <label><input type="radio" name="time" value="year"> This year</label>
          <label><input type="radio" name="time" value="custom"> Set up</label>
        </div>
        <div class="date-range">
          <input type="text" class="time-range form-control form-control-sm" placeholder="Select range">
          <div class="mt-2">
            <button type="button" class="btn btn-outline-primary btn-sm rounded-pill apply-range">Apply</button>
            <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill cancel-range">Cancel</button>
          </div>
        </div>
      </div>
      <div class="filter-group mb-3">
        <label class="form-label fw-bold">Sort by</label>
        <div class="sort-buttons d-flex flex-wrap">
          <button class="btn btn-outline-primary btn-sm" data-sort="asc">Enrolled ↑</button>
          <button class="btn btn-outline-primary btn-sm" data-sort="desc">Enrolled ↓</button>
          <button class="btn btn-outline-primary btn-sm" data-sort="offers">Offers</button>
          <button class="btn btn-outline-primary btn-sm" data-sort="applications">Applications</button>
        </div>
      </div>
    </aside>

    <section class="report-content col-lg-8">
      <h1 class="mb-3 text-center">Agent Performance Overview</h1>
      <h2 class="h5 text-muted mb-4">Agent Performance by Application Count</h2>
      <canvas id="mainChart" class="mb-4" height="200"></canvas>
      <div class="table-responsive">
        <table id="dataTable" class="table table-bordered table-sm">
          <thead class="table-light">
            <tr><th>Agent</th><th>Applications</th><th>Offers</th><th>Enrolled</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <aside class="chart-options col-lg-2">
      <h3 class="mb-3">Graphs and Charts</h3>
      <div class="d-flex flex-column gap-2">
        <button class="btn btn-outline-primary chart-btn active" data-type="bar"><i class="fa-solid fa-chart-column me-1"></i>Bar Chart</button>
        <button class="btn btn-outline-primary chart-btn" data-type="doughnut"><i class="fa-solid fa-circle-notch me-1"></i>Donut Chart</button>
        <button class="btn btn-outline-primary chart-btn" data-type="pie"><i class="fa-solid fa-chart-pie me-1"></i>Pie Chart</button>
        <button class="btn btn-outline-primary chart-btn" data-type="table"><i class="fa-solid fa-table me-1"></i>Table</button>
      </div>
    </aside>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/time_period_filter.js') }}"></script>
  <script>
  window.reportConfig = {
    endpoint: '/api/agent-performance',
    groupField: 'agent',
    chartLabel: 'Applications',
    columns: [
      {key: 'agent', label: 'Agent'},
      {key: 'applications', label: 'Applications'},
      {key: 'offers', label: 'Offers'},
      {key: 'enrolled', label: 'Enrolled'}
    ],
    sortFns: {
      asc: (a,b)=> (a.enrolled??0) - (b.enrolled??0),
      desc: (a,b)=> (b.enrolled??0) - (a.enrolled??0),
      offers: (a,b)=> (b.offers??0) - (a.offers??0),
      applications: (a,b)=> (b.applications??0) - (a.applications??0)
    }
  };
  </script>
<script src="{{ url_for('static', filename='js/report.js') }}" defer></script>
{% endblock %}
